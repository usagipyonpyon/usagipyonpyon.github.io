<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>pyon Profile</title>

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Comic+Neue:wght@400;700&family=M+PLUS+Rounded+1c:wght@400;700&family=ZCOOL+KuaiLe&display=swap" rel="stylesheet"/>

  <style>
    /* Reset */
    * { box-sizing: border-box; margin: 0; padding: 0; }
    html, body { height: 100%; }
    body {
      font-family: 'Comic Neue', 'M PLUS Rounded 1c', 'ZCOOL KuaiLe', sans-serif;
      background-color: #ffe4e9;
      background-image:
        radial-gradient(rgba(0,0,0,0.05) 2px, transparent 2px),
        radial-gradient(rgba(0,0,0,0.05) 2px, transparent 2px);
      background-size: 40px 40px;
      background-position: 0 0, 20px 20px;
      color: #333;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
    }

    /* Language Switcher */
    .lang-switcher {
      position: fixed;
      top: 16px;
      right: 16px;
      background: rgba(255,255,255,0.9);
      padding: 4px 12px;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      display: flex;
      align-items: center;
      gap: 4px;
      font-size: 0.9rem;
      z-index: 1000;
    }
    .lang-switcher .lang-label { font-weight: 600; color: #333; }
    .lang-switcher .lang-btn {
      text-decoration: none;
      background: #fff;
      color: #111;
      padding: 2px 6px;
      border-radius: 6px;
      box-shadow: 0 1px 4px rgba(0,0,0,0.1);
      transition: background 0.2s;
    }
    .lang-switcher .lang-btn.active,
    .lang-switcher .lang-btn:hover { background: #eaeaea; }
    .lang-switcher .lang-sep { color: #666; user-select: none; }

    /* Layout */
    .banner { width: 100%; max-width: 800px; margin-bottom: 20px; }
    .banner img { width: 100%; border-radius: 8px; }
    .container { width: 100%; max-width: 800px; }
    .profile { text-align: center; margin-bottom: 24px; }
    .profile img { width: 100px; height: 100px; border-radius: 50%; object-fit: cover; margin-bottom: 12px; }
    .profile h1 { font-size: 1.5rem; margin-bottom: 4px; text-align: center; }
    .profile p { font-size: 0.9rem; color: #666; line-height: 1.3; max-width: 800px; text-align: center; }
    .links { list-style: none; margin-bottom: 24px; }
    .links li { margin-bottom: 16px; text-align: center; }
    .links a {
      display: inline-block;
      width: 200px;
      height: 40px;
      line-height: 40px;
      text-decoration: none;
      background: #fff;
      color: #111;
      font-weight: 600;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      transition: background 0.2s;
    }
    .links a:hover { background: #eaeaea; }
    .note {
      margin-top: 8px;
      font-size: 0.85rem;
      color: #666;
      line-height: 1.4;
      width: 200px;
      margin: 0 auto;
      text-align: left;
    }
    .ad-container {
      background: #fff;
      padding: 12px;
      border: 2px dashed #ccc;
      border-radius: 8px;
      text-align: center;
      color: #555;
      font-size: 0.85rem;
      margin-top: 24px;
    }
    .visitor-footer { width: 100%; padding: 24px 0; text-align: center; margin-top: 40px; }
    .visitor-card {
      display: inline-flex;
      align-items: center;
      gap: 16px;
      padding: 16px 24px;
      background: rgba(255,255,255,0.85);
      border: 2px solid #ffcad4;
      border-radius: 24px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
      backdrop-filter: blur(8px);
    }
    .visitor-card .heart { font-size: 2rem; animation: beat 1.5s infinite; }
    .visitor-info .label { font-weight: 700; font-size: 0.85rem; color: #666; margin-bottom: 4px; }
    .visitor-info .count { font-weight: 700; font-size: 2rem; color: #ff4d6d; width: 7ch; text-align: center; letter-spacing: 0.05em; }
    @keyframes beat {0%,100%{transform:scale(1);}25%,75%{transform:scale(1.2);}50%{transform:scale(1);}}
    @media (prefers-color-scheme: dark) {
      body { background-color: #2a1a24; color: #ddd; }
      .links a { background: #2a2a2a; color: #eee; }
      .links a:hover { background: #3a2a34; }
      .profile p, .note { color: #aaa; }
      .ad-container { background: #2a2a2a; border-color: #555; color: #ccc; }
      .visitor-card { background: rgba(42,26,36,0.85); border-color: #59364a; box-shadow: 0 4px 12px rgba(0,0,0,0.3); }
      .visitor-info .label { color: #aaa; }
      .visitor-info .count { color: #ff9bb0; }
    }

    /* 保留換行 */
    [data-i18n-key] {
      white-space: pre-wrap;
    }
  </style>
</head>
<body>

  <!-- Language Switcher -->
  <div class="lang-switcher">
    <span class="lang-label" data-i18n-key="lang_label">Language:</span>
    <a href="#" class="lang-btn" data-lang="en" data-i18n-key="btn_en">EN</a>
    <span class="lang-sep">/</span>
    <a href="#" class="lang-btn" data-lang="ja" data-i18n-key="btn_ja">JP</a>
    <span class="lang-sep">/</span>
    <a href="#" class="lang-btn" data-lang="zh" data-i18n-key="btn_zh">CN</a>
  </div>

  <!-- Banner -->
  <header class="banner">
    <img src="ad6dadf1-3f23-4962-8e1f-ba16fdf585f9.png" alt="絵">
  </header>

  <div class="container">
    <!-- Profile -->
    <section class="profile">
      <img src="73cb3e4c-6fed-4379-9681-9b2d3aa78b96.png" alt="icon">
      <h1 class="note" data-i18n-key="title"></h1>
      <p class="note" data-i18n-key="intro"></p>
    </section>

<!-- Links -->
<ul class="links">
  <li>
    <a href="https://discord.gg/7wfBNYqrYU" target="_blank" data-i18n-key="btn_discord">Discord</a>
    <p class="note" data-i18n-key="discord_note"></p>
  </li>
  <li>
    <a href="https://t.me/usagi_pyonpyon_chat" target="_blank" data-i18n-key="btn_telegram">Telegram</a>
    <p class="note" data-i18n-key="telegram_note"></p>
  </li>
  <li>
    <a href="https://patreon.com/USAGIPYONPYON" target="_blank" data-i18n-key="btn_patreon">Patreon</a>
    <p class="note" data-i18n-key="patreon_note"></p>
  </li>
  <li>
    <a href="https://afdian.com/a/usagipyonpyon" target="_blank" data-i18n-key="btn_afdian">爱发电</a>
    <p class="note" data-i18n-key="afdian_note"></p>
  </li>
  <li>
    <a href="https://www.pixiv.net/users/115698769" target="_blank" data-i18n-key="btn_pixiv">PIXIV</a>
    <p class="note" data-i18n-key="pixiv_note"></p>
  </li>
</ul>


    <!-- Ad container -->
    <div class="ad-container">
      <p class="note" data-i18n-key="ad_title"></p>
      <p class="note" data-i18n-key="ad_text"></p>
      <a rel="noopener sponsored" href="https://dlaf.jp/home/dlaf/=/aid/usagipyonpyon/url/https%3A%2F%2Fwww.dlsite.com%2Fhome%2F%3Futm_medium%3Daffiliate%26utm_campaign%3Dbnlink%26utm_content%3Dbn_sp_300_250_dojin_01.gif" target="_blank">
        <img src="https://www.dlsite.com/img/male/dojin/bn_sp_300_250_dojin_01.gif" width="300" height="250" alt="DLsite">
      </a>
    </div>
  </div>

  <!-- Visitor Count -->
  <footer class="visitor-footer">
    <div class="visitor-card">
      <span class="heart">❤️</span>
      <div class="visitor-info">
        <div class="label">Page views</div>
        <div class="count" id="view-count">Loading</div>
      </div>
    </div>
  </footer>

  <!-- i18n Script -->
<script>
document.addEventListener('DOMContentLoaded', () => {
  let i18n = {};

  // 1) 加载 translations.json
  fetch('translations.json')
    .then(r => r.ok ? r.json() : Promise.reject(r.status))
    .then(data => {
      i18n = data;
      applyLang('ja');               // 默认日文
      document.querySelector('.lang-btn[data-lang="ja"]').classList.add('active');
    })
    .catch(err => console.error('i18n load failed:', err));

  // 2) 绑定切换事件
  document.querySelectorAll('.lang-btn').forEach(btn => {
    btn.addEventListener('click', e => {
      e.preventDefault();
      const lang = btn.dataset.lang;
      applyLang(lang);
      document.querySelectorAll('.lang-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
    });
  });

  // 3) 真正替换所有 [data-i18n-key]
  function applyLang(lang) {
    document.querySelectorAll('[data-i18n-key]').forEach(el => {
      const key = el.getAttribute('data-i18n-key');
      const txt = i18n[lang] && i18n[lang][key];
      if (txt !== undefined) {
        el.textContent = txt;
      }
    });
  }
});
</script>

<!-- Firebase SDK (兼容版) -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-storage-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDQDeDeKekDMyqdtul7to3CFJb6paQCn3k",
      authDomain: "pyon-d5faa.firebaseapp.com",
      databaseURL: "https://pyon-d5faa-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "pyon-d5faa",
      storageBucket: "pyon-d5faa.appspot.com",
      messagingSenderId: "769871960586",
      appId: "1:769871960586:web:6bb222e05bbd491f79ddf3"
    };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();
  const storage = firebase.storage();

  document.addEventListener('DOMContentLoaded', () => {
    const isAdmin = new URLSearchParams(location.search).get('admin') === '1';
    const formSec = document.getElementById('post-form');
    const feedSec = document.getElementById('posts-feed');

    // 只有 admin 模式下才显示表单
    if (isAdmin) formSec.style.display = 'block';

    // 绑定“发帖”按钮
    document.getElementById('post-submit').addEventListener('click', async () => {
      const now = new Date();
      const date = now.toISOString().slice(0, 19).replace('T', ' ');  // e.g. "2025-05-09 14:23:30"
      const file = document.getElementById('post-image').files[0];
      const text = document.getElementById('post-text').value.trim();
      if (!text && !file) return alert('请输入文字或上传图片');

      let imageUrl = '';
      if (file) {
        const path = `posts/${Date.now()}_${file.name}`;
        const snap = await storage.ref(path).put(file);
        imageUrl = await snap.ref.getDownloadURL();
      }

      // 写入 Realtime DB
      await db.ref('posts').push({ date, imageUrl, text });
      alert('Published!');
      document.getElementById('post-text').value = '';
      document.getElementById('post-image').value = '';
    });

    // 渲染帖子流：按 date 倒序
    db.ref('posts')
      .orderByChild('date')
      .on('value', snap => {
        const data = snap.val() || {};
        feedSec.innerHTML = '';
        Object.entries(data)
          .sort((a, b) => b[1].date.localeCompare(a[1].date))
          .forEach(([key, post]) => {
            const art = document.createElement('article');
            art.style.cssText = `
              background:#fff;
              padding:16px;
              border-radius:8px;
              box-shadow:0 2px 6px rgba(0,0,0,0.1);
              position: relative;
            `;

            // 如果是 admin 模式，添加删除按钮
            if (isAdmin) {
              const del = document.createElement('button');
              del.textContent = '删除';
              del.style.cssText = `
                position:absolute;
                top:8px; right:8px;
                background:#ff4d6d; color:#fff;
                border:none; padding:4px 8px;
                border-radius:4px; cursor:pointer;
              `;
              del.addEventListener('click', () => {
                if (confirm('确定要删除这篇文章吗？')) {
                  db.ref(`posts/${key}`)
                    .remove()
                    .then(() => art.remove())
                    .catch(err => alert('删除失败: ' + err.message));
                }
              });
              art.appendChild(del);
            }

            // 日期
            const d = document.createElement('div');
            d.textContent = post.date;
            d.style.cssText = 'font-size:0.85rem;color:#666;margin-bottom:8px;';
            art.appendChild(d);

            // 图片（有则展示）
            if (post.imageUrl) {
              const img = document.createElement('img');
              img.src = post.imageUrl;
              img.style.cssText = 'width:100%;border-radius:4px;margin-bottom:8px;';
              art.appendChild(img);
            }

            // 文本
            const p = document.createElement('p');
            p.textContent = post.text;
            p.style.cssText = 'white-space:pre-wrap;line-height:1.5;';
            art.appendChild(p);

            feedSec.appendChild(art);
          });
      });
  });
</script>

<!-- Admin 发帖表单（仅 admin 可以看到） -->
<section id="post-form" style="display:none; max-width:800px; margin:32px auto;
                               background:#fff; padding:16px; border-radius:8px;
                               box-shadow:0 2px 6px rgba(0,0,0,0.1);">
  <h2>📝 New Post</h2>
  <!-- Date 输入移除，自动使用电脑时间 -->
  <label>
    Image:
    <input type="file" id="post-image" accept="image/*" style="margin-bottom:8px;"/>
  </label><br/>
  <textarea id="post-text" rows="4" placeholder="Today's update..."
            style="width:100%; margin-bottom:8px;"></textarea><br/>
  <button id="post-submit" style="padding:8px 16px;">Publish</button>
</section>

<!-- 动态帖子流 -->
<section id="posts-feed"
         style="width:100%; max-width:800px; margin:32px auto;
                display:flex; flex-direction:column; gap:24px;">
  <!-- JS 会插入 <article>…</article> -->
</section>

</body>
</html>
